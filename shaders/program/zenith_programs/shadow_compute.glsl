/*
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ğŸŒŸ zenith_programs | shadow_compute - Ù†Ø¸Ø§Ù… Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø¸Ù„Ø§Ù„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… | VcorA ğŸŒŸ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Advanced Shadow Computation & Light Propagation System
    Ù†Ø¸Ø§Ù… Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø¸Ù„Ø§Ù„ ÙˆØ§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø¶ÙˆØ¡ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…

    âš¡ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© / Core Features:
    ----------------------------------------
    â€¢ Ù†Ø¸Ø§Ù… Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙˆÙ†Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… / Advanced Colored Lighting Computation
    â€¢ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø¶ÙˆØ¡ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ / 3D Light Propagation Algorithms
    â€¢ Ù†Ø¸Ø§Ù… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ØªÙƒÙŠÙ / Adaptive Performance Optimization
    â€¢ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…ØªÙˆØ§Ø²ÙŠØ© Ù„Ù„ÙÙˆÙƒØ³Ù„ / Parallel Voxel Processing
    â€¢ ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„ØªÙ…Ù„Ø¦Ø© Ø§Ù„ÙÙŠØ¶ÙŠØ© / Flood-fill Techniques
    â€¢ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø°ÙƒÙŠ / Smart Memory Management

    ğŸ¯ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© / Subsystems:
    --------------------------------
    [Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ù…ØªÙˆØ§Ø²ÙŠØ©] - Parallel Compute System with Work Groups
    [Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙˆÙƒØ³Ù„] - Voxel Processing with Light Sampling
    [ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡] - Performance Optimizations (Half Rate, Behind Player)
    [Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø¶ÙˆØ¡] - Light Propagation with Color Tinting
    [Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©] - Memory Management with Image Storage

    ğŸ“ˆ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© / Advanced Optimizations:
    ----------------------------------------------
    â˜… Work Group Configuration: ØªÙƒÙˆÙŠÙ† Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø­Ø³Ù†
    â˜… Half Rate Updates: ØªØ­Ø¯ÙŠØ«Ø§Øª Ù†ØµÙ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
    â˜… Behind Player Culling: Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø®Ù„Ù Ø§Ù„Ù„Ø§Ø¹Ø¨
    â˜… Adaptive Light Sampling: Ø£Ø®Ø° Ø¹ÙŠÙ†Ø§Øª Ø§Ù„Ø¶ÙˆØ¡ Ø§Ù„ØªÙƒÙŠÙÙŠ
    â˜… Memory Optimization: ØªØ­Ø³ÙŠÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø©

    ğŸ”§ Ù…Ø·ÙˆØ± Ø¨ÙˆØ§Ø³Ø·Ø© / Developed by: VcorA
    ğŸ“… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®ÙŠØ± / Last Updated: 2025
    ğŸ® Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ / Compatible with: OptiFine & Iris Compute Shaders

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/

/////////////////////////////////////
// Zenith Shader - Enhanced by VcorA //
/////////////////////////////////////

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Core Library Includes | Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#include "/lib/shader_modules/shader_master.glsl"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Shadow Compute Implementation | ØªØ·Ø¨ÙŠÙ‚ Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø¸Ù„Ø§Ù„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#ifdef SHADOWCOMP

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Enhanced Performance Optimizations
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#define OPTIMIZATION_ACL_HALF_RATE_UPDATES    // Half rate updates
#define OPTIMIZATION_ACL_BEHIND_PLAYER        // Behind player culling

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Advanced Compute Configuration | ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
layout (local_size_x = 8, local_size_y = 8, local_size_z = 8) in;

// Ù†Ø¸Ø§Ù… ØªÙƒÙˆÙŠÙ† Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØªÙƒÙŠÙÙŠ / Adaptive Work Group Configuration System
#if COLORED_LIGHTING_INTERNAL == 128
	const ivec3 workGroups = ivec3(16, 8, 16);      // ØªÙƒÙˆÙŠÙ† ØµØºÙŠØ± / Small configuration
#elif COLORED_LIGHTING_INTERNAL == 192
	const ivec3 workGroups = ivec3(24, 12, 24);     // ØªÙƒÙˆÙŠÙ† Ù…ØªÙˆØ³Ø· / Medium configuration
#elif COLORED_LIGHTING_INTERNAL == 256
	const ivec3 workGroups = ivec3(32, 16, 32);     // ØªÙƒÙˆÙŠÙ† ÙƒØ¨ÙŠØ± / Large configuration
#elif COLORED_LIGHTING_INTERNAL == 384
	const ivec3 workGroups = ivec3(48, 24, 48);     // ØªÙƒÙˆÙŠÙ† ÙØ§Ø¦Ù‚ / Extra large configuration
#elif COLORED_LIGHTING_INTERNAL == 512
	const ivec3 workGroups = ivec3(64, 32, 64);     // ØªÙƒÙˆÙŠÙ† Ø¶Ø®Ù… / Huge configuration
#elif COLORED_LIGHTING_INTERNAL == 768
	const ivec3 workGroups = ivec3(96, 32, 96);     // ØªÙƒÙˆÙŠÙ† Ø¹Ù…Ù„Ø§Ù‚ / Ultra configuration
#elif COLORED_LIGHTING_INTERNAL == 1024
	const ivec3 workGroups = ivec3(128, 32, 128);   // ØªÙƒÙˆÙŠÙ† Ø£Ù‚ØµÙ‰ / Maximum configuration
#endif

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 3D Direction Vectors for Light Sampling | Ù…ØªØ¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ù„Ø£Ø®Ø° Ø¹ÙŠÙ†Ø§Øª Ø§Ù„Ø¶ÙˆØ¡
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ivec3[6] face_offsets = ivec3[6](
	ivec3( 1,  0,  0),    // +X Ø§ØªØ¬Ø§Ù‡ / +X direction
	ivec3( 0,  1,  0),    // +Y Ø§ØªØ¬Ø§Ù‡ / +Y direction
	ivec3( 0,  0,  1),    // +Z Ø§ØªØ¬Ø§Ù‡ / +Z direction
	ivec3(-1,  0,  0),    // -X Ø§ØªØ¬Ø§Ù‡ / -X direction
	ivec3( 0, -1,  0),    // -Y Ø§ØªØ¬Ø§Ù‡ / -Y direction
	ivec3( 0,  0, -1)     // -Z Ø§ØªØ¬Ø§Ù‡ / -Z direction
);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Advanced Image Storage Interface | ÙˆØ§Ø¬Ù‡Ø© ØªØ®Ø²ÙŠÙ† Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
writeonly uniform image3D floodfill_img;       // ØµÙˆØ±Ø© Ø§Ù„ØªÙ…Ù„Ø¦Ø© Ø§Ù„ÙÙŠØ¶ÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© / Primary flood-fill image
writeonly uniform image3D floodfill_img_copy;  // Ù†Ø³Ø®Ø© ØµÙˆØ±Ø© Ø§Ù„ØªÙ…Ù„Ø¦Ø© Ø§Ù„ÙÙŠØ¶ÙŠØ© / Flood-fill image copy

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Enhanced Light Sampling Functions | Ø¯ÙˆØ§Ù„ Ø£Ø®Ø° Ø¹ÙŠÙ†Ø§Øª Ø§Ù„Ø¶ÙˆØ¡ Ø§Ù„Ù…Ø­Ø³Ù†Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Advanced Light Sample Extraction | Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¹ÙŠÙ†Ø© Ø§Ù„Ø¶ÙˆØ¡ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
vec4 GetLightSample(sampler3D lightSampler, ivec3 pos) {
	return texelFetch(lightSampler, pos, 0);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Enhanced Light Averaging Algorithm | Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¶ÙˆØ¡ Ø§Ù„Ù…Ø­Ø³Ù†Ø©
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
vec4 GetLightAverage(sampler3D lightSampler, ivec3 pos, ivec3 voxelVolumeSize) {
	// Ø£Ø®Ø° Ø¹ÙŠÙ†Ø© Ø§Ù„Ø¶ÙˆØ¡ Ø§Ù„Ø­Ø§Ù„ÙŠØ© / Get current light sample
	vec4 light_old = GetLightSample(lightSampler, pos);
	
	// Ø£Ø®Ø° Ø¹ÙŠÙ†Ø§Øª Ø§Ù„Ø¶ÙˆØ¡ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø³ØªØ© / Sample light from all six directions
	vec4 light_px  = GetLightSample(lightSampler, clamp(pos + face_offsets[0], ivec3(0), voxelVolumeSize - 1));
	vec4 light_py  = GetLightSample(lightSampler, clamp(pos + face_offsets[1], ivec3(0), voxelVolumeSize - 1));
	vec4 light_pz  = GetLightSample(lightSampler, clamp(pos + face_offsets[2], ivec3(0), voxelVolumeSize - 1));
	vec4 light_nx  = GetLightSample(lightSampler, clamp(pos + face_offsets[3], ivec3(0), voxelVolumeSize - 1));
	vec4 light_ny  = GetLightSample(lightSampler, clamp(pos + face_offsets[4], ivec3(0), voxelVolumeSize - 1));
	vec4 light_nz  = GetLightSample(lightSampler, clamp(pos + face_offsets[5], ivec3(0), voxelVolumeSize - 1));

	// Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¶ÙˆØ¡ Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø¶ÙˆØ¡ / Calculate light average with enhanced propagation
	vec4 light = light_old + light_px + light_py + light_pz + light_nx + light_ny + light_nz;
    return light / 7.2; // Ø£Ø¹Ù„Ù‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù…Ù† 7 Ù„Ù…Ù†Ø¹ Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø¶ÙˆØ¡ Ø¨Ø¹ÙŠØ¯Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ / Slightly higher than 7 to prevent light from travelling too far
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Essential Library Includes | Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#include "/lib/effects/effects_unified.glsl"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Main Shadow Computation Function | Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø¸Ù„Ø§Ù„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
void main() {
	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	// Enhanced Position and Offset Calculation | Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¶Ø¹ ÙˆØ§Ù„Ø¥Ø²Ø§Ø­Ø© Ø§Ù„Ù…Ø­Ø³Ù†
	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	ivec3 pos = ivec3(gl_GlobalInvocationID);
	vec3 posM = vec3(pos) / vec3(voxelVolumeSize);
	vec3 posOffset = floor(previousCameraPosition) - floor(cameraPosition);
	ivec3 previousPos = ivec3(vec3(pos) - posOffset);

	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	// Advanced Distance-Based Optimization | ØªØ­Ø³ÙŠÙ† Ù‚Ø§Ø¦Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	ivec3 absPosFromCenter = abs(pos - voxelVolumeSize / 2);
	if (absPosFromCenter.x + absPosFromCenter.y + absPosFromCenter.z > 16) {
	#ifdef OPTIMIZATION_ACL_BEHIND_PLAYER
		// Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø±Ø¤ÙŠØ© Ù„Ù„ØªØ­Ø³ÙŠÙ† / Calculate view position for optimization
		vec4 viewPos = gbufferProjectionInverse * vec4(0.0, 0.0, 1.0, 1.0);
		viewPos /= viewPos.w;
		vec3 nPlayerPos = normalize(mat3(gbufferModelViewInverse) * viewPos.xyz);
		
		// ØªØ­Ø³ÙŠÙ†: Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø®Ù„Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ / Optimization: cull areas behind player
		if (dot(normalize(posM - 0.5), nPlayerPos) < 0.0) {
			#ifdef COLORED_LIGHT_FOG
				// Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ Ù„Ù„Ø£Ø¯Ø§Ø¡ / Double buffering system for performance
				if ((frameCounter & 1) == 0) {
					imageStore(floodfill_img_copy, pos, GetLightSample(floodfill_sampler, previousPos));
				} else {
					imageStore(floodfill_img, pos, GetLightSample(floodfill_sampler_copy, previousPos));
				}
			#endif
			return;
		}
	#endif
	}

	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	// Enhanced Light Processing and Voxel Analysis | Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¶ÙˆØ¡ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙˆÙƒØ³Ù„ Ø§Ù„Ù…Ø­Ø³Ù†
	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	vec4 light = vec4(0.0);
	uint voxel = texelFetch(voxel_sampler, pos, 0).x;

	// Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ Ù„Ù„Ø¥Ø·Ø§Ø±Ø§Øª / Frame-based double buffering system
	if ((frameCounter & 1) == 0) {
		// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙˆÙƒØ³Ù„ Ø§Ù„ØµÙ„Ø¨Ø© / Process solid voxels
		if (voxel == 1u) {
			imageStore(floodfill_img_copy, pos, vec4(0.0));
			return;
		}
		
		#ifdef OPTIMIZATION_ACL_HALF_RATE_UPDATES
			// ØªØ­Ø³ÙŠÙ†: ØªØ­Ø¯ÙŠØ«Ø§Øª Ù†ØµÙ Ø§Ù„Ù…Ø¹Ø¯Ù„ / Optimization: half rate updates
			if (posM.x < 0.5) {
				imageStore(floodfill_img_copy, pos, GetLightSample(floodfill_sampler, previousPos));
				return;
			}
		#endif
		
		// Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¶ÙˆØ¡ Ø§Ù„Ù…Ø­Ø³Ù† / Calculate enhanced light average
		light = GetLightAverage(floodfill_sampler, previousPos, voxelVolumeSize);
	} else {
		// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø¨Ø¯ÙŠÙ„ / Process alternate frame
		if (voxel == 1u) {
			imageStore(floodfill_img, pos, vec4(0.0));
			return;
		}
		
		#ifdef OPTIMIZATION_ACL_HALF_RATE_UPDATES
			// ØªØ­Ø³ÙŠÙ†: ØªØ­Ø¯ÙŠØ«Ø§Øª Ù†ØµÙ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ù„Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø¨Ø¯ÙŠÙ„ / Optimization: half rate updates for alternate frame
			if (posM.x > 0.5) {
				imageStore(floodfill_img, pos, GetLightSample(floodfill_sampler_copy, previousPos));
				return;
			}
		#endif
		
		// Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¶ÙˆØ¡ Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ø¨Ø¯ÙŠÙ„ / Calculate light average from alternate source
		light = GetLightAverage(floodfill_sampler_copy, previousPos, voxelVolumeSize);
	}

	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	// Advanced Block Light Processing | Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„ÙƒØªÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	if (voxel == 0u || voxel >= 200u) {
		// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙƒØªÙ„ Ø§Ù„Ù…Ù„ÙˆÙ†Ø© Ø§Ù„Ø®Ø§ØµØ© / Process special colored blocks
		if (voxel >= 200u) {
			vec3 tint = specialTintColor[min(voxel - 200u, specialTintColor.length() - 1u)];
			light.rgb *= tint; // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø®Ø§Øµ / Apply special tinting
		}
	} else {
		// Ù…Ø¹Ø§Ù„Ø¬Ø© ÙƒØªÙ„ Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¶ÙˆØ¡ / Process light source blocks
		vec4 color = GetSpecialBlocklightColor(int(voxel));
		light = max(light, vec4(pow2(color.rgb), color.a)); // ØªØ­Ø³ÙŠÙ† Ø³Ø·ÙˆØ¹ Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¶ÙˆØ¡ / Enhanced light source brightness
	}

	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	// Final Image Storage with Double Buffering | ØªØ®Ø²ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ø¹ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬
	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	if ((frameCounter & 1) == 0) {
		imageStore(floodfill_img_copy, pos, light);
	} else {
		imageStore(floodfill_img, pos, light);
	}
}

#endif

/*
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    âœ¨ ØªÙ… Ø¥Ù†Ø¬Ø§Ø² shadow_compute.glsl Ø¨Ù†Ø¬Ø§Ø­ - VcorA âœ¨
    ğŸŒŸ Shadow_compute.glsl completed successfully - VcorA ğŸŒŸ
    
    ğŸ¯ Ù†Ø¸Ø§Ù… Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø¸Ù„Ø§Ù„ ÙˆØ§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙˆÙ†Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…ÙƒØªÙ…Ù„
    ğŸ¯ Advanced Shadow Computation & Colored Lighting System Complete
    
    ğŸ’ ØªÙ… Ø¨Ù†Ø§Ø¤Ù‡ Ø¨ÙØ®Ø± Ù…Ù† Ù‚Ø¨Ù„ VcorA
    ğŸ’ Proudly built by VcorA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/
